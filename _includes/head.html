<header class="site-header">
  <div class="header-container">
    <a href="/vidyavantage.github.io/" class="site-logo">
      üéì VidyaVantage
    </a>
    
    <nav class="site-nav">
      <a href="/vidyavantage.github.io/">Home</a>
      <a href="/vidyavantage.github.io/colleges/">Colleges</a>
      <a href="/vidyavantage.github.io/visa">Visa Services</a>
      <a href="/vidyavantage.github.io/blog/">Blogs & Research</a>
      <a href="https://github.com/antoniovn96" target="_blank" class="contact-link">Contact Me</a>
      
      <button id="globalLoginBtn" class="btn-login" style="border:none; cursor:pointer; font-family:inherit;">Portal Login</button>
    </nav>
    
    <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
  </div>
</header>

<style>
  .site-header { background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; font-family: 'Nunito', 'Inter', sans-serif;}
  .header-container { max-width: 1200px; margin: 0 auto; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
  .site-logo { font-size: 1.5rem; font-weight: 900; color: #0A2342; text-decoration: none; }
  
  .site-nav { display: flex; gap: 25px; align-items: center; }
  .site-nav a { text-decoration: none; color: #475569; font-weight: 700; font-size: 0.95rem; transition: 0.2s; }
  .site-nav a:hover { color: #2563EB; }
  
  /* Contact Link Styling */
  .contact-link { color: #64748b !important; border-right: 2px solid #e2e8f0; padding-right: 25px; }
  .contact-link:hover { color: #0A2342 !important; }

  /* Login Button Styling */
  .btn-login { 
    background: #2563EB; 
    color: white !important; 
    padding: 10px 22px; 
    border-radius: 50px; 
    font-weight: 800 !important;
    box-shadow: 0 4px 10px rgba(37, 99, 235, 0.2);
    transition: all 0.3s ease;
  }
  .btn-login:hover { 
    background: #1E40AF; 
    transform: translateY(-2px); 
    box-shadow: 0 6px 15px rgba(37, 99, 235, 0.3);
  }
  
  .menu-toggle { display: none; background: none; border: none; font-size: 1.8rem; cursor: pointer; color: #0A2342; }

  /* Mobile Responsiveness */
  @media (max-width: 900px) {
    .site-nav { 
      display: none; 
      flex-direction: column; 
      position: absolute; 
      top: 100%; 
      left: 0; 
      width: 100%; 
      background: white; 
      padding: 20px 0; 
      box-shadow: 0 10px 15px rgba(0,0,0,0.1); 
      text-align: center;
    }
    .site-nav.active { display: flex; }
    .site-nav a, .btn-login { padding: 10px 0; width: 100%; }
    .contact-link { border-right: none; padding-right: 0; border-bottom: 2px solid #e2e8f0; margin-bottom: 10px; padding-bottom: 15px; }
    .btn-login { width: 80%; margin: 10px auto 0; padding: 12px; }
    .menu-toggle { display: block; }
  }
</style>

<script>
  function toggleMenu() {
    document.querySelector('.site-nav').classList.toggle('active');
  }
</script>

<script type="module">
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    // ‚ö†Ô∏è YOUR EXACT FIREBASE CONFIG
    const firebaseConfig = {
      apiKey: "AIzaSyBygHYMOSuKueZf9nE5LmSwCyCeZ2dNeD0",
      authDomain: "career-intelligence-system.firebaseapp.com",
      projectId: "career-intelligence-system",
      storageBucket: "career-intelligence-system.firebasestorage.app",
      messagingSenderId: "223785446772",
      appId: "1:223785446772:web:0f9ded4e89a978fc551021",
      measurementId: "G-HGKJJN9KDF"
    };

    // Initialize Firebase safely (prevents errors if initialized multiple times across Jekyll includes)
    const app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0];
    const auth = getAuth(app);
    const db = getFirestore(app);

    // üö® YOUR MASTER ADMIN EMAIL
    const SUPER_ADMIN_EMAIL = "antonio.antonio.noronha@gmail.com"; 

    const loginBtn = document.getElementById('globalLoginBtn');
    
    if(loginBtn) {
        loginBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            const user = auth.currentUser;
            
            // 1. If NOT logged in, send them to the homepage to see the Auth Box
            if (!user) {
                window.location.href = "/vidyavantage.github.io/";
                return;
            }

            // 2. If LOGGED IN, check their identity and teleport them
            loginBtn.innerText = "Routing... ‚è≥";
            const email = user.email.toLowerCase();
            
            try {
                // Route Super Admin
                if (email === SUPER_ADMIN_EMAIL.toLowerCase()) {
                    window.location.href = "/vidyavantage.github.io/admin.html";
                    return;
                }

                // Route VIPs (School Admin / Counsellor)
                const permsSnap = await getDoc(doc(db, "permissions", email));
                if (permsSnap.exists()) {
                    const role = permsSnap.data().role;
                    if (role === "school_admin") window.location.href = "/vidyavantage.github.io/school_dashboard.html";
                    else if (role === "counsellor") window.location.href = "/vidyavantage.github.io/counsellor_dashboard.html";
                    return;
                }

                // Route Students
                window.location.href = "/vidyavantage.github.io/student_portal.html";

            } catch (error) {
                console.error("Global Routing Error:", error);
                loginBtn.innerText = "Portal Login";
                alert("Error connecting to server. Please try again.");
            }
        });
    }
</script>
