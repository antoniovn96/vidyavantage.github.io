<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Institutional Dashboard | Career Platform</title>
    <style>
      /* --- SCHOOL DASHBOARD THEME --- */
      :root {
        --bg: #0f172a; --sidebar: #172033; --card-bg: #1e293b; 
        --primary: #3b82f6; /* Switched to a trustworthy blue for Schools */
        --secondary: #06b6d4; --accent: #f43f5e;
        --text-main: #f8fafc; --text-muted: #94a3b8; --border: #334155;
        --success: #10b981; --warning: #f59e0b; --danger: #ef4444;
      }
      body { background-color: var(--bg); font-family: 'Nunito', sans-serif; color: var(--text-main); margin: 0; display: flex; height: 100vh; overflow: hidden; }
      
      /* SIDEBAR */
      .sidebar { width: 300px; background: var(--sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; overflow-y: auto; padding-top: 20px;}
      .sidebar::-webkit-scrollbar { width: 6px; }
      .sidebar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
      
      .brand { padding: 0 20px 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.05); margin-bottom: 15px; }
      .brand h2 { margin: 0; font-size: 1.4rem; color: white; font-weight: 900; }
      .brand span { color: var(--primary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; font-weight: bold;}
      
      .school-profile { padding: 0 20px 20px; text-align: center; }
      .school-logo-wrapper { width: 80px; height: 80px; margin: 0 auto 10px; background: white; border-radius: 12px; padding: 5px; border: 2px solid var(--border); }
      .school-logo { width: 100%; height: 100%; object-fit: contain; }
      .school-name { margin: 0 0 5px 0; font-size: 1.1rem; font-weight: 800; }
      
      .nav-btn { background: transparent; color: var(--text-muted); border: none; text-align: left; padding: 15px 25px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: 0.2s; border-left: 4px solid transparent; width: 100%; display: flex; align-items: center; gap: 10px; }
      .nav-btn:hover { background: rgba(255,255,255,0.05); color: white; }
      .nav-btn.active { background: rgba(59, 130, 246, 0.1); color: var(--primary); border-left-color: var(--primary); }

      /* MAIN CONTENT AREA */
      .main-content { flex: 1; padding: 30px 40px; overflow-y: auto; position: relative;}
      .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
      .header-bar h1 { margin: 0; font-size: 1.8rem; }
      
      /* TABS */
      .tab-content { display: none; animation: fadeIn 0.3s ease; }
      .tab-content.active { display: block; }
      
      /* UI COMPONENTS */
      .card { background: var(--card-bg); padding: 25px; border-radius: 16px; border: 1px solid var(--border); margin-bottom: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
      .card h3 { margin-top: 0; color: white; border-bottom: 1px solid var(--border); padding-bottom: 10px; font-size: 1.2rem; display: flex; justify-content: space-between; align-items: center; }
      
      .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px; }
      .kpi-box { background: linear-gradient(135deg, rgba(30,41,59,1) 0%, rgba(15,23,42,1) 100%); padding: 20px; border-radius: 12px; border: 1px solid var(--border); text-align: left; position: relative; overflow: hidden; }
      .kpi-box::after { content: ''; position: absolute; top: 0; right: 0; width: 4px; height: 100%; background: var(--border); }
      .kpi-box h4 { margin: 0; color: var(--text-muted); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.5px; }
      .kpi-box .val { font-size: 2rem; font-weight: 900; color: white; margin: 8px 0 5px; }
      .kpi-box .trend { font-size: 0.85rem; color: var(--text-muted); }

      .form-group { margin-bottom: 15px; }
      .form-label { display: block; font-weight: 700; margin-bottom: 6px; color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase;}
      .form-input, .form-select, .form-textarea { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 0.95rem; color: white; background: #0f172a; box-sizing: border-box; font-family: inherit;}
      .form-input:focus, .form-select:focus, .form-textarea:focus { border-color: var(--primary); outline: none; }
      .form-textarea { resize: vertical; min-height: 80px; }

      .checkbox-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
      .checkbox-label { display: flex; align-items: center; gap: 10px; font-size: 0.95rem; cursor: pointer; color: var(--text-main); }

      .btn { background: linear-gradient(45deg, var(--primary), #2563eb); color: white; border: none; padding: 12px 25px; font-size: 1rem; font-weight: bold; border-radius: 8px; cursor: pointer; transition: 0.2s; }
      .btn:hover { opacity: 0.9; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);}

      .crm-section-title { font-size: 1.1rem; color: var(--secondary); border-bottom: 1px dashed var(--border); padding-bottom: 8px; margin: 30px 0 15px 0; display: flex; align-items: center; gap: 10px;}
      .crm-section-title span { background: rgba(6, 182, 212, 0.1); padding: 5px 10px; border-radius: 6px; font-size: 0.9rem;}
      
      .grid-4col { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 15px; }
      .grid-3col { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
      .grid-2col { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

      /* Progress Bars for Intelligence Layer */
      .metric-row { margin-bottom: 15px; }
      .metric-head { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px; font-weight: bold; }
      .metric-track { width: 100%; background: var(--bg); height: 8px; border-radius: 10px; overflow: hidden; border: 1px solid var(--border); }
      .metric-fill { height: 100%; border-radius: 10px; }

      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="brand">
        <h2>Career Intel</h2>
        <span>Institutional Portal</span>
    </div>

    <div class="school-profile">
        <div class="school-logo-wrapper">
            <img src="https://via.placeholder.com/80x80.png?text=Logo" alt="School Logo" class="school-logo" id="dispSchoolLogo">
        </div>
        <h3 class="school-name" id="dispSchoolName">Your Institution</h3>
        <p style="margin:0; font-size:0.8rem; color:var(--text-muted);" id="dispSchoolId">ID: Loading...</p>
    </div>

    <button class="nav-btn active" onclick="switchTab('tab-analytics', this)">üìä Intelligence Dashboard</button>
    <button class="nav-btn" onclick="switchTab('tab-profile', this)">üè¢ Institutional Profile</button>
    <button class="nav-btn" onclick="switchTab('tab-students', this)">üéì Student Roster</button>
</div>

<div class="main-content">

    <div id="tab-analytics" class="tab-content active">
        <div class="header-bar">
            <h1>Institution Analytics Dashboard</h1>
            <button class="btn" style="background:transparent; border:1px solid var(--primary); color:var(--primary);">üì• Export Report</button>
        </div>

        <h3 class="crm-section-title" style="margin-top:0;"><span>1</span> Student Analytics Snapshot</h3>
        <div class="kpi-grid">
            <div class="kpi-box" style="--border: var(--primary);"><h4>Total Registered</h4><div class="val">450</div><div class="trend">Accounts created</div></div>
            <div class="kpi-box" style="--border: var(--success);"><h4>Active Students</h4><div class="val">412</div><div class="trend">Logged in recently</div></div>
            <div class="kpi-box" style="--border: var(--secondary);"><h4>Assessments Done</h4><div class="val">92%</div><div class="trend">Completion rate</div></div>
            <div class="kpi-box" style="--border: var(--danger);"><h4>High Risk / Immediate Action</h4><div class="val" style="color:var(--danger);">14</div><div class="trend">High confusion/pressure</div></div>
            <div class="kpi-box" style="--border: var(--warning);"><h4>Avg. Career Clarity</h4><div class="val">6.4<span style="font-size:1rem;">/10</span></div><div class="trend">Cohort average</div></div>
            <div class="kpi-box" style="--border: var(--success);"><h4>Avg. Confidence</h4><div class="val">7.2<span style="font-size:1rem;">/10</span></div><div class="trend">Cohort average</div></div>
        </div>

        <div class="grid-2col">
            <div class="card">
                <h3 style="color:var(--secondary); border-bottom:1px solid var(--border); padding-bottom:10px;">Career & Stream Trends</h3>
                
                <h4 style="margin: 15px 0 5px; color:white; font-size:0.95rem;">Top 5 Career Interests</h4>
                <ul style="color: var(--text-muted); font-size:0.9rem; padding-left: 20px; line-height: 1.6; margin-bottom: 20px;">
                    <li>Engineering & Technology</li>
                    <li>Healthcare & Clinical Sciences</li>
                    <li>Business & Financial Management</li>
                    <li>Design & Creative Arts</li>
                    <li>Civil Services / Government</li>
                </ul>

                <h4 style="margin: 0 0 10px; color:white; font-size:0.95rem;">Stream Preference Breakdown</h4>
                <div style="display:flex; width:100%; height:12px; border-radius:10px; overflow:hidden; margin-bottom:5px;">
                    <div style="width:45%; background:var(--primary);"></div>
                    <div style="width:35%; background:var(--secondary);"></div>
                    <div style="width:20%; background:var(--accent);"></div>
                </div>
                <div style="display:flex; justify-content:space-between; font-size:0.8rem; color:var(--text-muted); margin-bottom:20px;">
                    <span>STEM (45%)</span><span>Commerce (35%)</span><span>Humanities (20%)</span>
                </div>

                <div class="grid-2col" style="gap:10px;">
                    <div style="background:var(--bg); padding:10px; border-radius:8px; text-align:center; border:1px solid var(--border);">
                        <div style="font-size:0.8rem; color:var(--text-muted);">Govt vs Private Sector</div>
                        <strong style="color:white;">28% / 72%</strong>
                    </div>
                    <div style="background:var(--bg); padding:10px; border-radius:8px; text-align:center; border:1px solid var(--border);">
                        <div style="font-size:0.8rem; color:var(--text-muted);">Abroad Interest</div>
                        <strong style="color:var(--primary);">34%</strong>
                    </div>
                </div>
            </div>

            <div style="display:flex; flex-direction:column; gap:25px;">
                <div class="card" style="margin:0;">
                    <h3 style="color:var(--accent); border-bottom:1px solid var(--border); padding-bottom:10px;">Skill Gap Analysis (Needs Intervention)</h3>
                    
                    <div class="metric-row"><div class="metric-head"><span>Communication Weakness</span><span>22%</span></div>
                    <div class="metric-track"><div class="metric-fill" style="width: 22%; background:var(--warning);"></div></div></div>
                    
                    <div class="metric-row"><div class="metric-head"><span>Analytical Weakness</span><span>38%</span></div>
                    <div class="metric-track"><div class="metric-fill" style="width: 38%; background:var(--danger);"></div></div></div>
                    
                    <div class="metric-row"><div class="metric-head"><span>Leadership Weakness</span><span>45%</span></div>
                    <div class="metric-track"><div class="metric-fill" style="width: 45%; background:var(--danger);"></div></div></div>
                    
                    <div class="metric-row" style="margin:0;"><div class="metric-head"><span>Decision-Making Weakness</span><span>18%</span></div>
                    <div class="metric-track"><div class="metric-fill" style="width: 18%; background:var(--warning);"></div></div></div>
                </div>

                <div class="card" style="margin:0;">
                    <h3 style="color:var(--success); border-bottom:1px solid var(--border); padding-bottom:10px;">Parent & Student Engagement</h3>
                    <div class="grid-2col" style="margin-bottom: 10px;">
                        <div><p style="margin:0; font-size:0.85rem; color:var(--text-muted);">Parent Meetings Requested</p><strong style="font-size:1.5rem; color:white;">48</strong></div>
                        <div><p style="margin:0; font-size:0.85rem; color:var(--text-muted);">Reports Downloaded</p><strong style="font-size:1.5rem; color:white;">390</strong></div>
                    </div>
                    <div class="grid-2col" style="margin-bottom: 15px;">
                        <div><p style="margin:0; font-size:0.85rem; color:var(--text-muted);">Counselling Sessions Done</p><strong style="font-size:1.5rem; color:white;">112</strong></div>
                        <div><p style="margin:0; font-size:0.85rem; color:var(--text-muted);">Session Attendance</p><strong style="font-size:1.5rem; color:var(--success);">94%</strong></div>
                    </div>
                    <div style="background:rgba(16, 185, 129, 0.1); padding:10px; border-radius:8px; text-align:center; color:var(--success); border:1px solid rgba(16, 185, 129, 0.2);">
                        <strong>Platform Feedback Rating: 4.8 / 5.0 ‚≠ê</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="tab-profile" class="tab-content">
        <div class="header-bar">
            <h1>Institution Master Data</h1>
            <button class="btn" id="saveCRMBtn" onclick="saveCRMInstitution()">üíæ Save Changes</button>
        </div>

        <div class="card" style="border-left: 4px solid var(--primary); padding-top:10px;">
            
            <h3 class="crm-section-title"><span>A</span> Basic Details</h3>
            <div class="grid-3col" style="align-items: center;">
                <div class="form-group" style="grid-column: span 2;">
                    <label class="form-label">Institution Name</label>
                    <input type="text" id="crmName" class="form-input" placeholder="e.g., The Knowledge Habitat">
                </div>
                <div class="form-group" style="text-align: center;">
                    <label class="form-label">Institution Logo</label>
                    <div style="display:flex; align-items:center; gap:15px; justify-content:center;">
                        <img id="crmLogoDisp" src="https://placehold.co/150" style="width:60px; height:60px; border-radius:8px; object-fit:cover; border:1px solid var(--border);">
                        <button class="btn" style="padding: 8px 15px; font-size: 0.85rem;" onclick="document.getElementById('crmLogoUpload').click()">Upload</button>
                        <input type="file" id="crmLogoUpload" style="display:none;" accept="image/png, image/jpeg">
                    </div>
                </div>
            </div>
            
            <div class="grid-4col">
                <div class="form-group"><label class="form-label">Board</label><select id="crmBoard" class="form-select"><option>CBSE</option><option>ICSE</option><option>State Board</option><option>IB</option><option>IGCSE</option></select></div>
                <div class="form-group"><label class="form-label">Type</label><select id="crmType" class="form-select"><option>School</option><option>PU College</option><option>Degree</option><option>Coaching</option></select></div>
                <div class="form-group"><label class="form-label">Academic Year</label><input type="text" id="crmYear" class="form-input" placeholder="e.g., 2026-2027"></div>
                <div class="form-group"><label class="form-label">Website</label><input type="url" id="crmWeb" class="form-input" placeholder="https://..."></div>
            </div>

            <div class="form-group"><label class="form-label">Address</label><input type="text" id="crmAddress" class="form-input" placeholder="Street Address"></div>
            <div class="grid-4col">
                <div class="form-group"><label class="form-label">City</label><input type="text" id="crmCity" class="form-input"></div>
                <div class="form-group"><label class="form-label">State</label><input type="text" id="crmState" class="form-input"></div>
                <div class="form-group"><label class="form-label">Country</label><input type="text" id="crmCountry" class="form-input" value="India"></div>
                <div class="form-group"><label class="form-label">Pincode</label><input type="text" id="crmPin" class="form-input"></div>
            </div>

            <h3 class="crm-section-title"><span>B</span> Administrative Contact</h3>
            <div class="grid-3col">
                <div class="form-group"><label class="form-label">Principal Name</label><input type="text" id="crmPrincipal" class="form-input"></div>
                <div class="form-group"><label class="form-label">Career Coordinator Name</label><input type="text" id="crmCoord" class="form-input"></div>
                <div class="form-group"><label class="form-label">Designation</label><input type="text" id="crmDesig" class="form-input" placeholder="e.g., Lead Counselor"></div>
            </div>
            <div class="grid-4col">
                <div class="form-group" style="grid-column: span 2;"><label class="form-label">Email</label><input type="email" id="crmEmail" class="form-input"></div>
                <div class="form-group"><label class="form-label">Primary Phone</label><input type="text" id="crmPhone1" class="form-input"></div>
                <div class="form-group"><label class="form-label">WhatsApp Number</label><input type="text" id="crmPhoneWA" class="form-input"></div>
            </div>
            <div class="form-group" style="width: 50%;"><label class="form-label">Alternate Contact</label><input type="text" id="crmPhone2" class="form-input"></div>

            <h3 class="crm-section-title"><span>C</span> Academic Structure</h3>
            <div class="form-group">
                <label class="form-label">Streams Offered</label>
                <div class="checkbox-grid" style="grid-template-columns: repeat(5, 1fr);">
                    <label class="checkbox-label"><input type="checkbox" id="stPCM" value="Science (PCM)"> Science (PCM)</label>
                    <label class="checkbox-label"><input type="checkbox" id="stPCB" value="Science (PCB)"> Science (PCB)</label>
                    <label class="checkbox-label"><input type="checkbox" id="stComm" value="Commerce"> Commerce</label>
                    <label class="checkbox-label"><input type="checkbox" id="stArts" value="Humanities"> Humanities</label>
                    <label class="checkbox-label"><input type="checkbox" id="stVoc" value="Vocational"> Vocational</label>
                </div>
            </div>
            <div class="grid-2col">
                <div class="form-group"><label class="form-label">Subject Combinations</label><textarea id="crmCombos" class="form-textarea" placeholder="e.g., PCMB, PCMC, CEBA..."></textarea></div>
                <div class="form-group"><label class="form-label">Stream Cut-off Policy</label><textarea id="crmCutoff" class="form-textarea" placeholder="e.g., Min 85% for Science..."></textarea></div>
            </div>
            <div class="grid-2col">
                <div class="form-group"><label class="form-label">Competitive Coaching Support</label><select id="crmCoaching" class="form-select"><option>Yes</option><option>No</option></select></div>
                <div class="form-group"><label class="form-label">Internal Counsellor Available</label><select id="crmIntCouns" class="form-select"><option>Yes</option><option>No</option></select></div>
            </div>

            <div style="background: rgba(0,0,0,0.15); padding: 20px; border-radius: 12px; margin-top: 30px; border: 1px solid rgba(255,255,255,0.05);">
                <h3 class="crm-section-title" style="margin-top:0; border-bottom:none;">Account & Subscription (Managed by Admin)</h3>
                
                <div class="grid-4col">
                    <div class="form-group"><label class="form-label">Plan Type</label><input type="text" id="crmPlan" class="form-input" disabled></div>
                    <div class="form-group"><label class="form-label">Student Licenses</label><input type="text" id="crmLicTotal" class="form-input" disabled></div>
                    <div class="form-group"><label class="form-label">Licenses Used</label><input type="text" id="crmLicUsed" class="form-input" disabled></div>
                    <div class="form-group"><label class="form-label">Expiry Date</label><input type="text" id="crmExpiry" class="form-input" disabled></div>
                </div>
                <div class="grid-4col">
                    <div class="form-group"><label class="form-label">Account Status</label><input type="text" id="crmStatus" class="form-input" disabled></div>
                    <div class="form-group"><label class="form-label">Outstanding Amount</label><input type="text" id="crmOutst" class="form-input" disabled></div>
                    <div class="form-group"><label class="form-label">GST Number</label><input type="text" id="crmGST" class="form-input" disabled></div>
                    <div class="form-group"><label class="form-label">Invoices</label><button class="btn" style="width:100%; background:transparent; border:1px solid var(--border); color:var(--text-muted);" disabled>üìÑ View Invoices</button></div>
                </div>
            </div>
            
        </div>
    </div>

    <div id="tab-students" class="tab-content">
        <div class="header-bar">
            <h1>Student Roster</h1>
            <p style="color:var(--text-muted);">Manage your student cohort here.</p>
        </div>
    </div>

</div>

<script type="module">
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";

const auth = getAuth();

// SECURE BOUNCER LOGIC
onAuthStateChanged(auth, async (user) => {
    if (!user) {
        // Not logged in at all? Boot to login.
        window.location.href = "login.html";
        return;
    }

    const email = user.email.toLowerCase();
    
    // Check their role in the permissions collection
    const permsRef = doc(db, "permissions", email);
    const permsSnap = await getDoc(permsRef);

    if (permsSnap.exists()) {
        const role = permsSnap.data().role;
        
        // --- Dashboard Specific Logic ---
        // If we are on the SCHOOL dashboard, but they are a COUNSELLOR... kick them out.
        const currentPage = window.location.pathname;
        
        if (currentPage.includes("school_dashboard") && role !== "school_admin") {
            alert("Unauthorized Access: This area is for School Admins only.");
            window.location.href = "login.html";
        }
        
        if (currentPage.includes("counsellor_dashboard") && role !== "counsellor") {
            alert("Unauthorized Access: This area is for Counsellors only.");
            window.location.href = "login.html";
        }
        
    } else {
        // If they are logged in but NOT on your permission list, they are a student.
        // They shouldn't be here!
        window.location.href = "student_portal.html";
    }
});
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    // ‚ö†Ô∏è REPLACE WITH YOUR EXACT FIREBASE KEYS
    const firebaseConfig = {
      apiKey: "AIzaSyBygHYMOSuKueZf9nE5LmSwCyCeZ2dNeD0",
      authDomain: "career-intelligence-system.firebaseapp.com",
      projectId: "career-intelligence-system",
      storageBucket: "career-intelligence-system.firebasestorage.app",
      messagingSenderId: "223785446772",
      appId: "1:223785446772:web:0f9ded4e89a978fc551021",
      measurementId: "G-HGKJJN9KDF"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Tab Switching
    window.switchTab = function(tabId, btn) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        btn.classList.add('active');
    };

    // Note: Since this is the School's dashboard, we would load *their specific* ID from Firebase Auth here. 
    // For now, we will save their edits to a dummy document to prove it works.
    let currentSchoolId = "SCH_DEMO_001"; 
    let uploadedSchoolLogoBase64 = "";

    // School Logo Compressor
    document.getElementById('crmLogoUpload').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = function(event) {
            const img = new Image();
            img.src = event.target.result;
            img.onload = function() {
                const canvas = document.createElement('canvas');
                canvas.width = 150; canvas.height = 150; 
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                uploadedSchoolLogoBase64 = canvas.toDataURL("image/jpeg", 0.8);
                document.getElementById('crmLogoDisp').src = uploadedSchoolLogoBase64;
                document.getElementById('dispSchoolLogo').src = uploadedSchoolLogoBase64;
            }
        };
    });

    window.saveCRMInstitution = async function() {
        const btn = document.getElementById('saveCRMBtn');
        btn.innerText = "Saving Profile... ‚è≥";

        const crmData = {
            name: document.getElementById('crmName').value,
            logo: uploadedSchoolLogoBase64,
            board: document.getElementById('crmBoard').value,
            city: document.getElementById('crmCity').value,
            principal: document.getElementById('crmPrincipal').value,
            email: document.getElementById('crmEmail').value,
            // (We will save all fields in the final build, keeping it simple for UI test)
            lastUpdated: new Date().toISOString()
        };

        try {
            await setDoc(doc(db, "schools", currentSchoolId), crmData, { merge: true });
            document.getElementById('dispSchoolName').innerText = crmData.name || "Your Institution";
            document.getElementById('dispSchoolId').innerText = `ID: ${currentSchoolId}`;
            alert("Institutional Profile Saved Successfully!");
        } catch (e) { 
            console.error(e); 
            alert("Error saving data."); 
        } finally { 
            btn.innerText = "üíæ Save Changes"; 
        }
    };
</script>

</body>
</html>
