<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Dashboard | Career Intelligence</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        --bg: #f8fafc; --sidebar: #0f172a; --card-bg: #ffffff; 
        --primary: #3b82f6; --secondary: #10b981; --accent: #f59e0b;
        --text-main: #1e293b; --text-muted: #64748b; --border: #e2e8f0;
        --success: #10b981; --warning: #f59e0b; --danger: #ef4444;
      }
      body { background-color: var(--bg); font-family: 'Nunito', sans-serif; color: var(--text-main); margin: 0; display: flex; height: 100vh; overflow: hidden; }
      
      /* --- SIDEBAR --- */
      .sidebar { width: 280px; background: var(--sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; overflow-y: auto; color: white;}
      .profile-info { text-align: center; padding: 30px 20px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 10px; background: radial-gradient(circle at top, #1e293b, #0f172a);}
      .stu-avatar { width: 70px; height: 70px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; margin: 0 auto 15px; font-weight: bold; border: 3px solid rgba(255,255,255,0.2);}
      
      .nav-menu { padding: 10px; display: flex; flex-direction: column; gap: 5px; }
      .nav-btn { background: transparent; color: #94a3b8; border: none; text-align: left; padding: 12px 20px; width: 100%; cursor: pointer; border-radius: 8px; font-weight: bold; font-size: 0.95rem; display: flex; align-items: center; gap: 12px; transition: 0.2s;}
      .nav-btn:hover { background: rgba(255,255,255,0.05); color: white;}
      .nav-btn.active { background: var(--primary); color: white; }

      /* --- MAIN CONTENT & LAYOUT --- */
      .main-wrapper { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
      .top-header { background: white; height: 70px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; padding: 0 40px; box-shadow: 0 2px 10px rgba(0,0,0,0.02);}
      
      .main-content { flex: 1; padding: 30px 40px; overflow-y: auto; position: relative;}
      .tab-content { display: none; animation: fadeIn 0.3s ease; }
      .tab-content.active { display: block; }
      
      .header-bar { margin-bottom: 30px; display: flex; justify-content: space-between; align-items: flex-end;}
      .header-bar h1 { margin: 0 0 5px 0; font-size: 1.8rem; color: #0f172a;}
      .header-bar p { margin: 0; color: var(--text-muted); }

      /* --- UI COMPONENTS --- */
      .card { background: var(--card-bg); padding: 25px; border-radius: 16px; border: 1px solid var(--border); margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); }
      .card h3 { margin-top: 0; color: #0f172a; border-bottom: 1px solid var(--border); padding-bottom: 15px; font-size: 1.1rem; display: flex; justify-content: space-between; align-items: center; }
      
      .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
      .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; }
      
      /* Snapshot Cards */
      .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
      .kpi-box { background: white; padding: 20px; border-radius: 12px; border: 1px solid var(--border); text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.02);}
      .kpi-box h4 { margin:0 0 10px 0; color:var(--text-muted); font-size:0.8rem; text-transform:uppercase;}
      .kpi-box .val { font-size:1.8rem; font-weight:900; color: var(--primary); }

      /* Career Clarity Meter */
      .clarity-meter-wrap { background: linear-gradient(135deg, #1e293b, #0f172a); color: white; padding: 30px; border-radius: 16px; position: relative; overflow: hidden;}
      .clarity-score { font-size: 3.5rem; font-weight: 900; color: var(--accent); line-height: 1; margin-bottom: 5px;}
      .meter-bg { width: 100%; height: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; margin-top: 15px; overflow: hidden;}
      .meter-fill { height: 100%; background: var(--accent); width: 40%; border-radius: 5px;}

      .btn { background: var(--primary); color: white; border: none; padding: 12px 25px; font-size: 1rem; font-weight: bold; border-radius: 8px; cursor: pointer; transition: 0.2s; display: inline-flex; align-items: center; gap: 8px; text-decoration: none;}
      .btn:hover { opacity: 0.9; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);}
      .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
      .btn-outline:hover { background: var(--primary); color: white; }

      .status-pill { padding: 4px 12px; border-radius: 20px; font-weight: bold; font-size: 0.8rem; text-transform: uppercase; background: #f1f5f9; color: #64748b;}
      .status-success { background: #d1fae5; color: #059669; }
      .status-warning { background: #fef3c7; color: #d97706; }

      /* Action Plan Tasks */
      .task-item { display: flex; align-items: center; gap: 15px; padding: 15px; border-bottom: 1px dashed var(--border); }
      .task-item:last-child { border: none; }
      .task-checkbox { width: 20px; height: 20px; cursor: pointer; }

      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="profile-info">
        <div class="stu-avatar" id="stuInitials">--</div>
        <h3 id="stuName" style="margin: 0 0 5px 0;">Loading Profile...</h3>
        <p id="stuInst" style="font-size:0.85rem; color:#94a3b8; margin:0;">...</p>
        <div style="margin-top: 15px;">
            <span style="font-size:0.75rem; color: #cbd5e1; text-transform:uppercase; font-weight:bold;">Profile Setup</span>
            <div style="width:80%; height:6px; background:rgba(255,255,255,0.1); border-radius:3px; margin:5px auto 0;">
                <div style="width:40%; height:100%; background:var(--success); border-radius:3px;"></div>
            </div>
        </div>
    </div>
    
    <nav class="nav-menu">
        <button class="nav-btn active" onclick="switchTab('tab-home', this)">üè† Dashboard</button>
        <button class="nav-btn" onclick="switchTab('tab-report', this)">üìÑ My Career Report</button>
        <button class="nav-btn" onclick="switchTab('tab-assessment', this)">üìù My Assessment</button>
        <button class="nav-btn" onclick="switchTab('tab-action', this)">üéØ Action Plan</button>
        <button class="nav-btn" onclick="switchTab('tab-portfolio', this)">üìÅ My Portfolio</button>
        <button class="nav-btn" onclick="switchTab('tab-counselling', this)">üìÖ Book Counselling</button>
        <button class="nav-btn" onclick="switchTab('tab-tracker', this)">üìà Progress Tracker</button>
        
        <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 15px 0;"></div>
        
        <button class="nav-btn" onclick="switchTab('tab-settings', this)">‚öôÔ∏è Profile Settings</button>
        <button class="nav-btn" style="color: #f87171;" id="logoutBtn">üö™ Secure Logout</button>
    </nav>
</div>

<div class="main-wrapper">
    <div class="top-header">
        <h2 style="margin:0; font-size:1.1rem; color:var(--text-muted);" id="headerTitle">Dashboard Home</h2>
        <div style="display:flex; align-items:center; gap:15px;">
            <span class="status-pill status-success">üü¢ System Online</span>
        </div>
    </div>

    <div class="main-content">
        
        <div id="tab-home" class="tab-content active">
            <div class="header-bar">
                <div>
                    <h1 id="welcomeText">Welcome back, Student!</h1>
                    <p>Let's take the next step toward your future today.</p>
                </div>
                <button class="btn" onclick="switchTab('tab-assessment', document.querySelectorAll('.nav-btn')[2])">Start Assessment ‚ûî</button>
            </div>

            <div class="grid-2" style="grid-template-columns: 1fr 1.5fr;">
                
                <div class="clarity-meter-wrap">
                    <h3 style="margin-top:0; color:white; border:none; opacity:0.8; font-size:1rem; text-transform:uppercase;">Career Clarity Score</h3>
                    <div class="clarity-score">4 <span style="font-size:1.5rem; color:#94a3b8;">/ 10</span></div>
                    <p style="color:#cbd5e1; font-size:0.9rem; margin-bottom:0;">Your clarity is low. Taking the psychometric assessment will instantly boost your score.</p>
                    <div class="meter-bg"><div class="meter-fill"></div></div>
                    
                    <div style="margin-top: 25px; padding-top: 20px; border-top: 1px dashed rgba(255,255,255,0.2);">
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <span style="color:#94a3b8; font-size:0.85rem;">Confidence Level:</span>
                            <strong style="color:white;">Moderate</strong>
                        </div>
                        <div style="display:flex; justify-content:space-between;">
                            <span style="color:#94a3b8; font-size:0.85rem;">Status:</span>
                            <strong style="color:var(--warning);">Assessment Pending</strong>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="kpi-grid">
                        <div class="kpi-box" style="border-top: 3px solid var(--warning);"><h4>Assessment Status</h4><div class="val" style="color:var(--warning); font-size:1.2rem; margin-top:15px;">Action Needed</div></div>
                        <div class="kpi-box" style="border-top: 3px solid var(--primary);"><h4>Next Session</h4><div class="val" style="color:#0f172a; font-size:1.2rem; margin-top:15px;">Not Booked</div></div>
                        <div class="kpi-box" style="border-top: 3px solid var(--success);"><h4>Action Plan</h4><div class="val" style="color:#0f172a;">0%</div></div>
                    </div>

                    <div class="card" style="margin-bottom:0; background: #eff6ff; border-color: #bfdbfe;">
                        <h3 style="border-bottom-color: #bfdbfe; color: var(--secondary);">üåü Weekly Career Tip</h3>
                        <p style="color: #1e40af; margin-bottom: 0;"><strong>Did you know?</strong> 65% of students change their major in college because they didn't align their core personality with their initial choice. Discover your RIASEC type in the Assessment tab to avoid this trap!</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-report" class="tab-content">
            <div class="header-bar">
                <div><h1>My Career Report</h1><p>Your personalized, AI-driven career and stream analysis.</p></div>
                <button class="btn btn-outline" disabled style="opacity:0.5; cursor:not-allowed;">üîí Download PDF</button>
            </div>
            
            <div class="card" style="text-align:center; padding: 60px 20px;">
                <div style="font-size: 4rem; margin-bottom: 20px;">üìÑ</div>
                <h2 style="color: #0f172a;">Report Locked</h2>
                <p style="color: var(--text-muted); max-width: 500px; margin: 0 auto 25px;">You need to complete your Clinical Psychometric Assessment before the AI can generate your personalized Career Report.</p>
                <button class="btn" onclick="switchTab('tab-assessment', document.querySelectorAll('.nav-btn')[2])">Take Assessment Now</button>
            </div>
        </div>

        <div id="tab-assessment" class="tab-content">
            <div class="header-bar"><h1>Clinical Assessment</h1><p>75-point psychometric evaluation to map your future.</p></div>
            
            <div class="card" style="border-top: 4px solid var(--primary);">
                <h3>Current Status: <span class="status-pill status-warning">Not Started</span></h3>
                <p style="color: var(--text-muted); line-height: 1.6; margin-bottom: 25px;">This assessment measures your RIASEC traits, inherent aptitudes, and emotional resilience. There are no right or wrong answers. Ensure you are in a quiet room and have 25 minutes to complete the test.</p>
                
                <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid var(--border);">
                    <h4 style="margin-top:0;">Modules Included:</h4>
                    <ul style="color: var(--text-muted); line-height: 1.8;">
                        <li><strong>Interest Test:</strong> Discovers what you naturally enjoy doing.</li>
                        <li><strong>Personality Map:</strong> Analyzes how you interact with work and people.</li>
                        <li><strong>Aptitude Check:</strong> Measures your problem-solving logic.</li>
                    </ul>
                </div>
                
                <button class="btn" style="width: 100%; justify-content: center; padding: 15px; font-size: 1.1rem;">Begin Full Assessment ‚ûî</button>
            </div>
        </div>

        <div id="tab-action" class="tab-content">
            <div class="header-bar"><h1>My Action Plan</h1><p>Turn your career insights into daily execution.</p></div>
            
            <div class="card">
                <h3>Skill Development Tasks</h3>
                <p style="color:var(--text-muted); font-size:0.9rem; margin-top:-5px; margin-bottom:20px;">Complete your assessment to get personalized tasks. Below are general suggestions.</p>
                
                <div class="task-item">
                    <input type="checkbox" class="task-checkbox">
                    <div style="flex:1;">
                        <strong style="display:block; color:#0f172a;">Complete Profile Setup</strong>
                        <span style="font-size:0.8rem; color:var(--text-muted);">Add your parent contact info in settings.</span>
                    </div>
                    <span class="status-pill" style="background:#f1f5f9;">Pending</span>
                </div>
                <div class="task-item">
                    <input type="checkbox" class="task-checkbox">
                    <div style="flex:1;">
                        <strong style="display:block; color:#0f172a;">Take Psychometric Assessment</strong>
                        <span style="font-size:0.8rem; color:var(--text-muted);">Unlock your career report.</span>
                    </div>
                    <span class="status-pill status-warning">High Priority</span>
                </div>
            </div>
        </div>

        <div id="tab-portfolio" class="tab-content">
            <div class="header-bar">
                <div><h1>My Portfolio</h1><p>Build your long-term academic and extracurricular profile.</p></div>
                <button class="btn btn-outline">+ Add Achievement</button>
            </div>
            <div class="card" style="text-align:center; padding: 50px;">
                <p style="color:var(--text-muted);">Your portfolio is currently empty. Start adding your Olympiad scores, sports certificates, or school projects to build a strong resume!</p>
            </div>
        </div>

        <div id="tab-counselling" class="tab-content">
            <div class="header-bar"><h1>Book Counselling</h1><p>Schedule a 1-on-1 session with your clinical expert.</p></div>
            <div class="grid-2">
                <div class="card" style="border-top: 4px solid var(--secondary);">
                    <h3>Schedule New Session</h3>
                    <div class="form-group">
                        <label class="form-label">Preferred Format</label>
                        <select class="form-select"><option>Online (Video Call)</option><option>Offline (In School)</option></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Topic of Discussion</label>
                        <select class="form-select"><option>Stream Selection</option><option>Report Explanation</option><option>Stress / Confusion</option></select>
                    </div>
                    <button class="btn" style="width:100%;">View Available Calendar</button>
                </div>
                <div class="card">
                    <h3>Session History</h3>
                    <p style="color:var(--text-muted); text-align:center; padding:20px;">No past sessions recorded.</p>
                </div>
            </div>
        </div>

        <div id="tab-tracker" class="tab-content">
            <div class="header-bar"><h1>Progress Tracker</h1><p>Visualizing your journey to career clarity.</p></div>
            <div class="card">
                <h3>Clarity Score Trend</h3>
                <p style="color:var(--text-muted); text-align:center; padding:40px;">Take your first assessment to establish a baseline score. Your graph will appear here.</p>
            </div>
        </div>

        <div id="tab-settings" class="tab-content">
            <div class="header-bar"><h1>Profile Settings</h1><p>Manage your account details and preferences.</p></div>
            <div class="card">
                <div class="grid-2" style="margin-bottom: 20px;">
                    <div class="form-group"><label class="form-label">Full Name</label><input type="text" id="setStuName" class="form-input" readonly></div>
                    <div class="form-group"><label class="form-label">Registered Email</label><input type="text" id="setStuEmail" class="form-input" readonly></div>
                </div>
                <div class="grid-2">
                    <div class="form-group"><label class="form-label">Parent Name</label><input type="text" class="form-input" placeholder="Optional"></div>
                    <div class="form-group"><label class="form-label">Parent Phone / WhatsApp</label><input type="text" class="form-input" placeholder="For automated reports"></div>
                </div>
                <button class="btn" style="margin-top:20px;">üíæ Save Details</button>
            </div>
        </div>

    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";

    // ‚ö†Ô∏è REPLACE WITH YOUR ACTUAL CONFIG
    const firebaseConfig = {
      apiKey: "AIzaSyBygHYMOSuKueZf9nE5LmSwCyCeZ2dNeD0",
      authDomain: "career-intelligence-system.firebaseapp.com",
      projectId: "career-intelligence-system",
      storageBucket: "career-intelligence-system.firebasestorage.app",
      messagingSenderId: "223785446772",
      appId: "1:223785446772:web:0f9ded4e89a978fc551021",
      measurementId: "G-HGKJJN9KDF"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // --- TAB NAVIGATION LOGIC ---
    window.switchTab = function(tabId, btn) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        btn.classList.add('active');
        document.getElementById('headerTitle').innerText = btn.innerText.replace(/[^\w\s]/gi, '').trim();
    };

    // --- FIREBASE AUTH & DATA LOADING ---
    onAuthStateChanged(auth, async (user) => {
        if (!user) {
            window.location.href = "index.html"; 
            return;
        }

        try {
            const studentRef = doc(db, "students", user.uid);
            const studentSnap = await getDoc(studentRef);

            if (studentSnap.exists()) {
                const data = studentSnap.data();
                
                // Populate UI with database info
                const firstName = data.name.split(' ')[0];
                document.getElementById('stuName').innerText = data.name;
                document.getElementById('welcomeText').innerText = `Welcome back, ${firstName}!`;
                document.getElementById('stuInitials').innerText = firstName.charAt(0).toUpperCase();
                
                document.getElementById('setStuName').value = data.name;
                document.getElementById('setStuEmail').value = data.email;

                // Handle Institution Display
                if (data.schoolId && data.schoolId !== "GENERAL") {
                    const schoolSnap = await getDoc(doc(db, "schools", data.schoolId));
                    if (schoolSnap.exists()) {
                        document.getElementById('stuInst').innerText = `${schoolSnap.data().name} | Grade ${data.grade}`;
                    }
                } else {
                    document.getElementById('stuInst').innerText = `Independent Student | Grade ${data.grade}`;
                }

                // Handle Assessment State (Future feature logic)
                if (data.assessmentCompleted) {
                    // Update UI to show unlocked report state
                }

            } else {
                // If they bypassed registration somehow
                window.location.href = "register.html";
            }
        } catch (error) {
            console.error("Data load failed:", error);
            alert("Error loading profile data.");
        }
    });

    // --- LOGOUT LOGIC ---
    document.getElementById('logoutBtn').addEventListener('click', () => {
        if(confirm("Are you sure you want to log out?")) {
            signOut(auth).then(() => {
                window.location.href = "index.html";
            });
        }
    });

</script>
</body>
</html>
